!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("clone"),require("d3-ease"),require("d3-hierarchy"),require("prop-types"),require("react"),require("core-js/fn/array/find"),require("core-js/fn/object/assign")):"function"==typeof define&&define.amd?define(["clone","d3-ease","d3-hierarchy","prop-types","react","core-js/fn/array/find","core-js/fn/object/assign"],r):(e=e||self).ReactTreeGraph=r(e.clone,e.d3,e.d3,e.PropTypes,e.React)}(this,function(a,e,u,r,p){"use strict";function o(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}function i(){return(i=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function c(s){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{},r=Object.keys(o);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(o).filter(function(e){return Object.getOwnPropertyDescriptor(o,e).enumerable}))),r.forEach(function(e){var r,t,n;r=s,n=o[t=e],t in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n})}return s}function d(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&s(e,r)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,r){return(s=Object.setPrototypeOf||function(e,r){return e.__proto__=r,e})(e,r)}function f(e,r){return!r||"object"!=typeof r&&"function"!=typeof r?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):r}function h(e){return function(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var y=/on[A-Z]/;function m(s){for(var e=arguments.length,o=new Array(1<e?e-1:0),r=1;r<e;r++)o[r-1]=arguments[r];var t=Object.keys(s).filter(function(e){return y.test(e)&&"function"==typeof s[e]}).reduce(function(e,r){var t,n;return e[r]=(t=s[r],n=o,function(e){return t.apply(void 0,[e].concat(h(n)))}),e},{});return c({},s,t)}var g={source:r.object.isRequired,target:r.object.isRequired,keyProp:r.string.isRequired,x1:r.number.isRequired,x2:r.number.isRequired,y1:r.number.isRequired,y2:r.number.isRequired,pathProps:r.object.isRequired};var P=function(e){function r(){return o(this,r),f(this,l(r).apply(this,arguments))}return d(r,p.PureComponent),t(r,[{key:"render",value:function(){var e,r,t,n,s=m(this.props.pathProps,this.props.source.data[this.props.keyProp],this.props.target.data[this.props.keyProp]),o=(e=this.props.x1,r=this.props.y1,t=this.props.x2,n=this.props.y2,"M".concat(r,",").concat(e,"C").concat((r+n)/2,",").concat(e," ").concat((r+n)/2,",").concat(t," ").concat(n,",").concat(t));return p.createElement("path",i({},s,{d:o}))}}]),r}();P.propTypes=g;var b={x:r.number.isRequired,y:r.number.isRequired,keyProp:r.string.isRequired,labelProp:r.string.isRequired,offset:r.number.isRequired,radius:r.number.isRequired,circleProps:r.object.isRequired,gProps:r.object.isRequired,textProps:r.object.isRequired},k=function(e){function r(){return o(this,r),f(this,l(r).apply(this,arguments))}return d(r,p.PureComponent),t(r,[{key:"getTransform",value:function(){return"translate(".concat(this.props.y,", ").concat(this.props.x,")")}},{key:"render",value:function(){var e=m(this.props.circleProps,this.props[this.props.keyProp]),r=m(this.props.gProps,this.props[this.props.keyProp]),t=m(this.props.textProps,this.props[this.props.keyProp]);return p.createElement("g",i({},r,{transform:this.getTransform()}),p.createElement("circle",i({},e,{r:this.props.radius})),p.createElement("text",i({},t,{dx:this.props.radius+.5,dy:this.props.offset}),this.props[this.props.labelProp]))}}]),r}();k.propTypes=b;var v={children:r.node,height:r.number.isRequired,keyProp:r.string.isRequired,labelProp:r.string.isRequired,links:r.array.isRequired,nodes:r.array.isRequired,nodeClassName:r.string,nodeOffset:r.number.isRequired,nodeRadius:r.number.isRequired,width:r.number.isRequired,circleProps:r.object.isRequired,gProps:r.object.isRequired,pathProps:r.object.isRequired,svgProps:r.object.isRequired,textProps:r.object.isRequired},R=function(e){function r(){return o(this,r),f(this,l(r).apply(this,arguments))}return d(r,p.PureComponent),t(r,[{key:"render",value:function(){var r=this;return p.createElement("svg",i({},this.props.svgProps,{height:this.props.height,width:this.props.width}),this.props.children,this.props.links.map(function(e){return p.createElement(P,{key:e.target.data[r.props.keyProp],keyProp:r.props.keyProp,source:e.source,target:e.target,x1:e.source.x,x2:e.target.x,y1:e.source.y,y2:e.target.y,pathProps:c({},r.props.pathProps,e.target.data.pathProps)})}),this.props.nodes.map(function(e){return p.createElement(k,i({key:e.data[r.props.keyProp],keyProp:r.props.keyProp,labelProp:r.props.labelProp,offset:r.props.nodeOffset,radius:r.props.nodeRadius,x:e.x,y:e.y,circleProps:c({},r.props.circleProps,e.data.circleProps),gProps:c({},r.props.gProps,e.data.gProps),textProps:c({},r.props.textProps,e.data.textProps)},e.data))}))}}]),r}();R.propTypes=v;var q={animated:r.bool.isRequired,getChildren:r.func.isRequired,keyProp:r.string.isRequired,links:r.array.isRequired,nodes:r.array.isRequired,duration:r.number.isRequired,easing:r.func.isRequired,steps:r.number.isRequired},x=function(e){function s(e){var r;if(o(this,s),r=f(this,l(s).call(this,e)),e.animated){var t=e.nodes[0].x,n=e.nodes[0].y;r.state={nodes:e.nodes.map(function(e){return c({},e,{x:t,y:n})}),links:e.links.map(function(e){return{source:c({},e.source,{x:t,y:n}),target:c({},e.target,{x:t,y:n})}})}}else r.state={nodes:e.nodes,links:e.links};return r}return d(s,p.PureComponent),t(s,[{key:"componentDidMount",value:function(){this.props.animated&&this.animate(this.props)}},{key:"componentWillReceiveProps",value:function(e){e.nodes===this.props.nodes&&e.links===this.props.links||(e.animated?this.animate(e):this.setState({nodes:e.nodes,links:e.links}))}},{key:"animate",value:function(e){var r=this;clearInterval(this.animation);var t=0,n=this.getAnimationContext(this.state,e);this.animation=setInterval(function(){if(++t===e.steps)return clearInterval(r.animation),r.animation=null,void r.setState({nodes:e.nodes,links:e.links});r.setState(r.calculateNewState(n,t/e.steps))},e.duration/e.steps)}},{key:"getAnimationContext",value:function(t,n){var s=this,e=n.nodes.filter(function(r){return t.nodes.every(function(e){return!s.areNodesSame(r,e)})}).map(function(e){return{base:e,old:s.getClosestAncestor(e,n,t),new:e}}),r=n.nodes.filter(function(r){return t.nodes.some(function(e){return s.areNodesSame(r,e)})}).map(function(r){return{base:r,old:t.nodes.find(function(e){return s.areNodesSame(r,e)}),new:r}}),o=t.nodes.filter(function(r){return n.nodes.every(function(e){return!s.areNodesSame(r,e)})}).map(function(e){return{base:e,old:e,new:s.getClosestAncestor(e,t,n)}}),i=n.links.filter(function(r){return t.links.every(function(e){return!s.areLinksSame(r,e)})}).map(function(e){return{base:e,old:s.getClosestAncestor(e.target,n,t),new:e}}),a=n.links.filter(function(r){return t.links.some(function(e){return s.areLinksSame(r,e)})}).map(function(r){return{base:r,old:t.links.find(function(e){return s.areLinksSame(r,e)}),new:r}}),u=t.links.filter(function(r){return n.links.every(function(e){return!s.areLinksSame(r,e)})}).map(function(e){return{base:e,old:e,new:s.getClosestAncestor(e.target,t,n)}});return{nodes:r.concat(e).concat(o),links:a.concat(i).concat(u)}}},{key:"getClosestAncestor",value:function(e,r,t){for(var n=this,s=e;s;){var o=t.nodes.find(function(e){return n.areNodesSame(s,e)});if(o)return o;s=r.nodes.find(function(e){return(n.props.getChildren(e)||[]).some(function(e){return n.areNodesSame(s,e)})})}return t.nodes[0]}},{key:"areNodesSame",value:function(e,r){return e.data[this.props.keyProp]===r.data[this.props.keyProp]}},{key:"areLinksSame",value:function(e,r){return e.source.data[this.props.keyProp]===r.source.data[this.props.keyProp]&&e.target.data[this.props.keyProp]===r.target.data[this.props.keyProp]}},{key:"calculateNewState",value:function(e,r){var t=this;return{nodes:e.nodes.map(function(e){return t.calculateNodePosition(e.base,e.old,e.new,r)}),links:e.links.map(function(e){return t.calculateLinkPosition(e.base,e.old,e.new,r)})}}},{key:"calculateNodePosition",value:function(e,r,t,n){return c({},e,{x:this.calculateNewValue(r.x,t.x,n),y:this.calculateNewValue(r.y,t.y,n)})}},{key:"calculateLinkPosition",value:function(e,r,t,n){return{source:c({},e.source,{x:this.calculateNewValue(r.source?r.source.x:r.x,t.source?t.source.x:t.x,n),y:this.calculateNewValue(r.source?r.source.y:r.y,t.source?t.source.y:t.y,n)}),target:c({},e.target,{x:this.calculateNewValue(r.target?r.target.x:r.x,t.target?t.target.x:t.x,n),y:this.calculateNewValue(r.target?r.target.y:r.y,t.target?t.target.y:t.y,n)})}}},{key:"calculateNewValue",value:function(e,r,t){return e+(r-e)*this.props.easing(t)}},{key:"render",value:function(){return p.createElement(R,i({},this.props,this.state))}}]),s}();x.propTypes=q;var j={data:r.object.isRequired,animated:r.bool.isRequired,children:r.node,duration:r.number.isRequired,easing:r.func.isRequired,steps:r.number.isRequired,height:r.number.isRequired,width:r.number.isRequired,keyProp:r.string.isRequired,labelProp:r.string.isRequired,getChildren:r.func.isRequired,margins:r.shape({bottom:r.number.isRequired,left:r.number.isRequired,right:r.number.isRequired,top:r.number.isRequired}).isRequired,nodeOffset:r.number.isRequired,nodeRadius:r.number.isRequired,circleProps:r.object.isRequired,gProps:r.object.isRequired,pathProps:r.object.isRequired,svgProps:r.object.isRequired,textProps:r.object.isRequired},w={animated:!1,duration:500,easing:e.easeQuadOut,getChildren:function(e){return e.children},steps:20,keyProp:"name",labelProp:"name",margins:{bottom:10,left:20,right:150,top:10},nodeOffset:3.5,nodeRadius:5,circleProps:{},gProps:{className:"node"},pathProps:{className:"link"},svgProps:{},textProps:{}},O=function(e){function r(){return o(this,r),f(this,l(r).apply(this,arguments))}return d(r,p.PureComponent),t(r,[{key:"render",value:function(){var r=this,e=this.props.width-this.props.margins.left-this.props.margins.right,t=this.props.height-this.props.margins.top-this.props.margins.bottom,n=u.hierarchy(a(this.props.data),this.props.getChildren),s=u.tree().size([t,e])(n),o=s.descendants(),i=s.links();return o.forEach(function(e){e.y+=r.props.margins.top}),p.createElement(x,{animated:this.props.animated,duration:this.props.duration,easing:this.props.easing,getChildren:this.props.getChildren,height:this.props.height,keyProp:this.props.keyProp,labelProp:this.props.labelProp,links:i,nodes:o,nodeOffset:this.props.nodeOffset,nodeRadius:this.props.nodeRadius,steps:this.props.steps,width:this.props.width,circleProps:this.props.circleProps,gProps:this.props.gProps,pathProps:this.props.pathProps,svgProps:this.props.svgProps,textProps:this.props.textProps},this.props.children)}}]),r}();return O.propTypes=j,O.defaultProps=w,O});
